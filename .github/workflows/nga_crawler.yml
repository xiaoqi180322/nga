name: NGA帖子抓取与推送
on:
  # 手动触发（方便测试）
  workflow_dispatch:
  # 定时触发：每隔5分钟执行一次（cron表达式，GitHub使用UTC时间，需转换为北京时间：UTC+8）
  schedule:
    - cron: '*/5 * * * *'  # 每分钟的第0秒、每5分钟执行（UTC时间），对应北京时间+8小时

jobs:
  crawl_nga:
    runs-on: ubuntu-latest
    steps:
      # 步骤1：拉取仓库代码
      - name: Checkout code
        uses: actions/checkout@v4
      
      # 步骤2：设置Python环境
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'  # 指定Python版本
      
      # 步骤3：安装依赖（requests是核心，可选BeautifulSoup）
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests beautifulsoup4  # beautifulsoup4可选，用于解析页面
      
      # 步骤4：执行抓取脚本（注入Secrets到环境变量）
      - name: Run NGA crawler
        env:
          NGA_COOKIE: ${{ secrets.NGA_COOKIE }}
          SERVERCHAN_SENDKEY: ${{ secrets.SERVERCHAN_SENDKEY }}
        run: |
          python nga_crawler.py
      
      # 步骤5：（可选）输出执行日志（方便调试）
      - name: Print execution log
        if: always()  # 无论成功/失败都执行
        run: |
          echo "任务执行完成，查看上方日志确认结果"
